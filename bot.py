import json
import asyncio
import os
from pathlib import Path
from dotenv import load_dotenv

from aiogram import Bot, Dispatcher, F
from aiogram.types import (
    Message, ReplyKeyboardMarkup, KeyboardButton, FSInputFile,
    InlineKeyboardMarkup, InlineKeyboardButton, CallbackQuery
)
from aiogram.enums import ParseMode
from aiogram.fsm.storage.memory import MemoryStorage
from aiogram import Router
from aiogram.client.default import DefaultBotProperties

# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ .env
load_dotenv()
BOT_TOKEN = os.getenv("BOT_TOKEN")
ADMIN_ID = int(os.getenv("ADMIN_ID"))
PHOTO_PATH = "welcome.jpeg"
USERS_FILE = "users.json"
VIDEO_URL = "https://rutube.ru/video/private/c947126ff41010ec1569c1cf15ebccb5/?p=lQ0V4DT8ANAYpue_xNDdVQ"

dp = Dispatcher(storage=MemoryStorage())
router = Router()
dp.include_router(router)

# –§–æ—Ç–∫–∏ –∫ –ø–æ—Å—Ç–∞–º
PHOTOS = {
    "p1": "p1.jpeg",
    "p2": "p2.jpeg",
    "p3": "p3.jpeg",
    "p4": "p4.jpeg",
    "p5": "p5.jpeg",
    "p6": "p6.jpeg",
    "p7": "p7.jpeg",
}

# üìÅ –†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
def load_users():
    if Path(USERS_FILE).exists():
        with open(USERS_FILE, "r", encoding="utf-8") as f:
            return json.load(f)
    return {}


def save_users(users_dict):
    with open(USERS_FILE, "w", encoding="utf-8") as f:
        json.dump(users_dict, f, ensure_ascii=False, indent=2)


users = load_users()

# üì≤ –ö–Ω–æ–ø–∫–∏
def get_contact_keyboard():
    return ReplyKeyboardMarkup(
        keyboard=[[KeyboardButton(text="üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º", request_contact=True)]],
        resize_keyboard=True
    )


def get_restart_keyboard():
    return ReplyKeyboardMarkup(
        keyboard=[[KeyboardButton(text="üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞")]],
        resize_keyboard=True
    )


def get_watch_video_keyboard():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="üìπ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ", url=VIDEO_URL)],
        [InlineKeyboardButton(text="–ü–æ—Å–º–æ—Ç—Ä–µ–ª –≤–∏–¥–µ–æ ‚úÖ", callback_data="watched_video")]
    ])


def get_message_me_keyboard():
    return InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="–ù–∞–ø–∏—Å–∞—Ç—å –º–Ω–µ", url="https://t.me/ArSdesigns")]
    ])

# üìù –°–æ–æ–±—â–µ–Ω–∏—è
WELCOME_TEXT = (
    "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è –≤ —Å–≤–æ–µ–º –±–æ—Ç–µ üëã\n\n"
    "–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —É—Ä–æ–∫, –Ω—É–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å, —á—Ç–æ —Ç—ã —á–µ–ª–æ–≤–µ–∫.\n\n"
    "–ù–∞–∂–∏–º–∞–π ¬´üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º¬ª, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç.\n\n"
    "–ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ –Ω–µ—Ç ‚Äî –Ω–∞–∂–º–∏ –Ω–∞ –∏–∫–æ–Ω–∫—É –≤ –ø—Ä–∞–≤–æ–º —É–≥–ª—É)"
)

VIDEO_TEXT = (
    "–û—á–µ–Ω—å —Ä–∞–¥ –≤–∏–¥–µ—Ç—å —Ç–µ–±—è –∑–¥–µ—Å—å –∏ –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –¥–æ–≤–µ—Ä–∏–µ. "
    "–í —ç—Ç–æ–º –≤–∏–¥–µ–æ—É—Ä–æ–∫–µ —è –ø–æ–¥—Ä–æ–±–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é, –∫–∞–∫ –º–æ–∂–Ω–æ "
    "<b>–≤—ã–π—Ç–∏ –Ω–∞ –¥–æ—Ö–æ–¥ –æ—Ç 100.000 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü –Ω–∞ –¥–∏–∑–∞–π–Ω–µ –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏.</b>\n\n"
    "–≠—Ç–æ—Ç —É—Ä–æ–∫ ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—à–µ–ª —è –∏ –º–æ–∏ —É—á–µ–Ω–∏–∫–∏. "
    "–≠—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∞—è –∫–∞—Ä—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è —à–∞–≥ –∑–∞ —à–∞–≥–æ–º –ø—Ä–∏–≤–µ–¥—ë—Ç —Ç–µ–±—è –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.\n\n"
    "–ü—Ä–æ—à—É —Ç–æ–ª—å–∫–æ –æ–± –æ–¥–Ω–æ–º ‚Äî –Ω–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–π –ø—Ä–æ—Å–º–æ—Ç—Ä. ¬´–ü–æ—Ç–æ–º¬ª –ª–µ–≥–∫–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ ¬´–Ω–∏–∫–æ–≥–¥–∞¬ª. "
    "–õ—É—á—à–µ –Ω–∞—á–Ω–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å ‚Äî —É—Ä–æ–∫ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —Ç–µ–±–µ –≤ –±–æ—Ç–µ –Ω–∏–∂–µ.\n\n"
    "–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞!"
)

# üì∏ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º
async def send_photo_with_text(bot: Bot, user_id: int, photo_path: str, caption: str, reply_markup=None):
    photo = FSInputFile(photo_path)
    await bot.send_photo(chat_id=user_id, photo=photo, caption=caption, reply_markup=reply_markup, parse_mode=ParseMode.HTML)

# üö® –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
async def reminder_task(bot: Bot, user_id: int, username: str):
    uid = str(user_id)

    # –ß–µ—Ä–µ–∑ 3 —á–∞—Å–∞
    await asyncio.sleep(3 * 60 * 60)
    if not users.get(uid, {}).get("contact", False):
        text = (
            f"{username}, —Ç—ã —Ç—É—Ç?\n–ú–Ω–µ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ —Ç–µ–±–µ –∫–æ–µ-—á—Ç–æ –≤–∞–∂–Ω–æ–µ —Å–∫–∞–∑–∞—Ç—å‚Ä¶\n\n"
            "–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å –≤ —Ä—É–∫–∞—Ö —Ä–∞–±–æ—á–∏–π –ø–ª–∞–Ω, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç "
            "<b>–≤—ã–≤–µ—Å—Ç–∏ —Ç–µ–±—è –Ω–∞ –¥–æ—Ö–æ–¥ –æ—Ç 100.000 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü —Å –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏.</b>\n"
            "–ù–µ —Å—É—Ö–∞—è —Ç–µ–æ—Ä–∏—è, –Ω–µ –∫—Ä–∞—Å–∏–≤—ã–µ –æ–±–µ—â–∞–Ω–∏—è, –∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ —è —Ä–∞—Å–ø–∏—Å–∞–ª –¥–ª—è —Ç–µ–±—è –≤ –≤–∏–¥–µ–æ.\n\n"
            "–ë–µ–∑ –≤–æ–¥—ã, –±–µ–∑ –¥–æ–≥–∞–¥–æ–∫, –±–µ–∑ —ç—Ç–∏—Ö –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö ¬´–∞ –≤–¥—Ä—É–≥ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è¬ª.\n"
            "–¢—ã –ø—Ä–æ—Å—Ç–æ –≤–∫–ª—é—á–∞–µ—à—å –≤–∏–¥–µ–æ, —Å–º–æ—Ç—Ä–∏—à—å <b>–≤—Å–µ–≥–æ 20 –º–∏–Ω—É—Ç</b> –∏ –≤—ã–ø–∏—Å—ã–≤–∞–µ—à—å –¥–ª—è —Å–µ–±—è –ø–µ—Ä–≤—ã–µ —à–∞–≥–∏.\n"
            "–ò —ç—Ç–æ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —Ç–µ–º –º–æ–º–µ–Ω—Ç–æ–º, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç–≤–æ–π –¥–æ—Ö–æ–¥ —Ä–µ–∞–ª—å–Ω–æ –Ω–∞—á–Ω—ë—Ç —Ä–∞—Å—Ç–∏.\n\n"
            "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ–º–µ–¥–ª–µ–Ω–∏—è = –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –∏ –¥–µ–Ω—å–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –±—ã—Ç—å —É —Ç–µ–±—è –Ω–∞ –∫–∞—Ä—Ç–µ.\n"
            "–°–µ—Ä—å–µ–∑–Ω–æ, –≤—Å–µ–≥–æ 20 –º–∏–Ω—É—Ç, –∞ –æ—Ç–¥–∞—á–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞ –≥–æ–¥—ã –≤–ø–µ—Ä—ë–¥.\n\n"
            "<b>–¢–∞–∫ —á—Ç–æ –≤–∫–ª—é—á–∞–π –≤–∏–¥–µ–æ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏ –Ω–∞—á–∏–Ω–∞–π —Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–µ–±—è.</b>"
        )
        await send_photo_with_text(bot, user_id, PHOTOS["p1"], text, get_contact_keyboard())

    # –ß–µ—Ä–µ–∑ 6 —á–∞—Å–æ–≤
    await asyncio.sleep(3 * 60 * 60)
    if not users.get(uid, {}).get("contact", False):
        text = (
            "–°–º–æ—Ç—Ä–∏, —Ç—É—Ç –≤—Å—ë –ø—Ä–æ—Å—Ç–æ.\n"
            "–ï—Å—Ç—å –¥–≤–∞ —Ç–∏–ø–∞ –ª—é–¥–µ–π:\n"
            "1. –¢–µ, –∫—Ç–æ —á–∏—Ç–∞—é—Ç –ø–æ—Å—Ç—ã, –∫–∏–≤–∞—é—Ç ¬´–æ, –∫–ª–∞—Å—Å–Ω–∞—è –∏–¥–µ—è¬ª –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—é—Ç.\n"
            "2. –¢–µ, –∫—Ç–æ –±–µ—Ä—É—Ç –≥–æ—Ç–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–≥–æ.\n\n"
            "–Ø —Å–¥–µ–ª–∞–ª –¥–ª—è —Ç–µ–±—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ‚Äî –≤–∏–¥–µ–æ —Å –ø–æ—à–∞–≥–æ–≤—ã–º –ø–ª–∞–Ω–æ–º "
            "<b>–≤—ã—Ö–æ–¥–∞ –Ω–∞ 100.000‚ÇΩ –≤ –º–µ—Å—è—Ü –Ω–∞ –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–µ.</b>\n"
            "<b>20 –º–∏–Ω—É—Ç –≤—Ä–µ–º–µ–Ω–∏</b> ‚Äî –∏ —É —Ç–µ–±—è –µ—Å—Ç—å –∫–∞—Ä—Ç–∞ –¥–µ–π—Å—Ç–≤–∏–π.\n\n"
            "–í–æ–ø—Ä–æ—Å: –≤ –∫–∞–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ö–æ—á–µ—à—å –æ—Å—Ç–∞—Ç—å—Å—è —Ç—ã?\n\n"
            "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–π, —á—Ç–æ —Ç—ã —á–µ–ª–æ–≤–µ–∫ ‚Äî –∏ —è –¥–∞–º —Ç–µ–±–µ –¥–æ—Å—Ç—É–ø –∫ –≤–∏–¥–µ–æ."
        )
        await send_photo_with_text(bot, user_id, PHOTOS["p7"], text, get_contact_keyboard())

    # –ß–µ—Ä–µ–∑ 9 —á–∞—Å–æ–≤
    await asyncio.sleep(3 * 60 * 60)
    if not users.get(uid, {}).get("contact", False):
        text = (
            "–ù—É –ª–∞–¥–Ω–æ, –Ω–∞–¥–µ—é—Å—å —Ç—ã –Ω–µ –±–æ—Ç)\n\n"
            "–î–µ—Ä–∂–∏ –≥–∞–π–¥, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π –¥–æ –∫–æ–Ω—Ü–∞ –∏ –∑–∞–±–∏—Ä–∞–π –ø–æ–¥–∞—Ä–æ–∫, "
            "–æ–Ω —Ç–µ–±–µ –ø–æ–º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –≤—ã—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Ç–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –≤—ã–π—Ç–∏ –Ω–∞ –∂–µ–ª–∞–Ω–Ω—ã–π –¥–æ—Ö–æ–¥."
        )
        await send_photo_with_text(bot, user_id, PHOTOS["p2"], text, get_watch_video_keyboard())

    # –ß–µ—Ä–µ–∑ 3 —á–∞—Å–∞ –ø–æ—Å–ª–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
    await asyncio.sleep(3 * 60 * 60)
    if users.get(uid, {}).get("contact", False) and not users[uid].get("watched", False):
        text = (
            f"{username}, —Ç—ã —Ç—É—Ç?\n–ú–Ω–µ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ —Ç–µ–±–µ –∫–æ–µ-—á—Ç–æ –≤–∞–∂–Ω–æ–µ —Å–∫–∞–∑–∞—Ç—å‚Ä¶\n\n"
            "–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å –≤ —Ä—É–∫–∞—Ö —Ä–∞–±–æ—á–∏–π –ø–ª–∞–Ω, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç "
            "<b>–≤—ã–≤–µ—Å—Ç–∏ —Ç–µ–±—è –Ω–∞ –¥–æ—Ö–æ–¥ –æ—Ç 100.000 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü —Å –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏.</b>\n"
            "–ù–µ —Å—É—Ö–∞—è —Ç–µ–æ—Ä–∏—è, –Ω–µ –∫—Ä–∞—Å–∏–≤—ã–µ –æ–±–µ—â–∞–Ω–∏—è, –∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ —è —Ä–∞—Å–ø–∏—Å–∞–ª –¥–ª—è —Ç–µ–±—è –≤ –≤–∏–¥–µ–æ.\n\n"
            "–ë–µ–∑ –≤–æ–¥—ã, –±–µ–∑ –¥–æ–≥–∞–¥–æ–∫, –±–µ–∑ —ç—Ç–∏—Ö –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö ¬´–∞ –≤–¥—Ä—É–≥ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è¬ª.\n"
            "–¢—ã –ø—Ä–æ—Å—Ç–æ –≤–∫–ª—é—á–∞–µ—à—å –≤–∏–¥–µ–æ, —Å–º–æ—Ç—Ä–∏—à—å <b>–≤—Å–µ–≥–æ 20 –º–∏–Ω—É—Ç</b> –∏ –≤—ã–ø–∏—Å—ã–≤–∞–µ—à—å –¥–ª—è —Å–µ–±—è –ø–µ—Ä–≤—ã–µ —à–∞–≥–∏.\n"
            "–ò —ç—Ç–æ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —Ç–µ–º –º–æ–º–µ–Ω—Ç–æ–º, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç–≤–æ–π –¥–æ—Ö–æ–¥ —Ä–µ–∞–ª—å–Ω–æ –Ω–∞—á–Ω—ë—Ç —Ä–∞—Å—Ç–∏.\n\n"
            "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ–º–µ–¥–ª–µ–Ω–∏—è = –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –∏ –¥–µ–Ω—å–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –±—ã—Ç—å —É —Ç–µ–±—è –Ω–∞ –∫–∞—Ä—Ç–µ.\n"
            "–°–µ—Ä—å–µ–∑–Ω–æ, –≤—Å–µ–≥–æ 20 –º–∏–Ω—É—Ç, –∞ –æ—Ç–¥–∞—á–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞ –≥–æ–¥—ã –≤–ø–µ—Ä—ë–¥.\n\n"
            "<b>–¢–∞–∫ —á—Ç–æ –≤–∫–ª—é—á–∞–π –≤–∏–¥–µ–æ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏ –Ω–∞—á–∏–Ω–∞–π —Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–µ–±—è.</b>"
        )
        await send_photo_with_text(bot, user_id, PHOTOS["p3"], text, get_watch_video_keyboard())

    # –ß–µ—Ä–µ–∑ 9 —á–∞—Å–æ–≤
    await asyncio.sleep(6 * 60 * 60)
    if not users[uid].get("watched", False):
        text = (
            "–ü—Ä–µ–¥—Å—Ç–∞–≤—å: –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤—Å–µ–≥–æ –º–µ—Å—è—Ü.\n"
            "–¢—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å –∫–æ—à–µ–ª—ë–∫ –∏ –≤–∏–¥–∏—à—å —Ç–∞–º –Ω–µ –º–µ–ª–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ –ø–æ—Å–ª–µ –¥–µ—à—ë–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤, "
            "–∞ <b>—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ 100.000 —Ä—É–±–ª–µ–π</b>, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç —Ç–µ–±–µ –∑–∞ –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫—É.\n\n"
            "–¢—ã –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–∞—Ç–∏—à—å –≤—Ä–µ–º—è –Ω–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø–æ–∏—Å–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤, –Ω–µ –≥–∞–¥–∞–µ—à—å, ¬´–∞ —á—Ç–æ –≤–æ–æ–±—â–µ –¥–µ–ª–∞—Ç—å¬ª, "
            "–Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞–µ—à—å, —á—Ç–æ —Ç–≤–æ–π —Ç—Ä—É–¥ —Å—Ç–æ–∏—Ç –∫–æ–ø–µ–π–∫–∏.\n\n"
            "–£ —Ç–µ–±—è –µ—Å—Ç—å —è—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: —à–∞–≥ –∑–∞ —à–∞–≥–æ–º —Ç—ã –∑–Ω–∞–µ—à—å, —á—Ç–æ –¥–µ–ª–∞—Ç—å, –∫–∞–∫ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤, "
            "–∫–∞–∫ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–≤–æ—é —Ü–µ–Ω–Ω–æ—Å—Ç—å, –∏ —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ ‚Äî –∫–∞–∫ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ.\n\n"
            "–ò –≤–æ—Ç —á—Ç–æ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ: —ç—Ç–æ—Ç –ø—É—Ç—å —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å –≤ —Ä—É–∫–∞—Ö.\n"
            "–Ø —É–ø–∞–∫–æ–≤–∞–ª –µ–≥–æ –≤ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤–∏–¥–µ–æ, –≥–¥–µ –ø–æ–∫–∞–∑–∞–ª –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω, –∫–∞–∫ –≤—ã–π—Ç–∏ –Ω–∞ 100.000 —Ä—É–±–ª–µ–π —Å –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏.\n"
            "–í—Å–µ–≥–æ 20 –º–∏–Ω—É—Ç ‚Äî –∏ —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å –≥–æ—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É.\n\n"
            "–¢—ã –º–æ–∂–µ—à—å —Ç—è–Ω—É—Ç—å –∏ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å. –ù–æ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ–º–µ–¥–ª–µ–Ω–∏—è ‚Äî —ç—Ç–æ –¥–µ–Ω—å–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –±—ã –±—ã—Ç—å —É —Ç–µ–±—è —É–∂–µ –∑–∞–≤—Ç—Ä–∞.\n"
            "–°–µ—Ä—å–µ–∑–Ω–æ, –ø–æ–¥—É–º–∞–π: <b>–ø–æ–∫–∞ —Ç—ã –¥—É–º–∞–µ—à—å ¬´–Ω—É –ø–æ—Ç–æ–º¬ª, —Ç–≤–æ–∏ –∫–ª–∏–µ–Ω—Ç—ã —É—Ö–æ–¥—è—Ç –∫ –¥—Ä—É–≥–∏–º.</b>\n\n"
            "<b>–•–æ—á–µ—à—å –∏–∑–º–µ–Ω–µ–Ω–∏–π? –¢–æ–≥–¥–∞ –Ω–µ –∂–¥–∏.</b>\n"
            "–°–º–æ—Ç—Ä–∏ –≤–∏–¥–µ–æ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏ –Ω–∞—á–∏–Ω–∞–π —Å—Ç—Ä–æ–∏—Ç—å —Å–µ–±–µ –¥–æ—Ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Ç–µ–±—è."
        )
        await send_photo_with_text(bot, user_id, PHOTOS["p4"], text, get_watch_video_keyboard())

    # –ß–µ—Ä–µ–∑ 12 —á–∞—Å–æ–≤
    await asyncio.sleep(11 * 60 * 60)
    if not users[uid].get("watched", False):
        text = (
            "<b>–ó–Ω–∞–µ—à—å, —á—Ç–æ —Å–∞–º–æ–µ –æ–ø–∞—Å–Ω–æ–µ?</b>\n"
            "–ù–µ —Ç–æ, —á—Ç–æ —Ç—ã —á–µ–≥–æ-—Ç–æ –Ω–µ –∑–Ω–∞–µ—à—å. –ò –¥–∞–∂–µ –Ω–µ —Ç–æ, —á—Ç–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –±–æ–ª—å—à–∞—è.\n"
            "–°–∞–º–æ–µ –æ–ø–∞—Å–Ω–æ–µ ‚Äî —ç—Ç–æ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–Ω–∏–µ.\n\n"
            "–ü–æ—Ç–æ–º—É —á—Ç–æ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, <b>–ø–æ–∫–∞ —Ç—ã –¥—É–º–∞–µ—à—å ¬´–Ω—É –ø–æ—Ç–æ–º¬ª, —Ç–≤–æ–∏ –∫–ª–∏–µ–Ω—Ç—ã —É—Ö–æ–¥—è—Ç –∫ –¥—Ä—É–≥–∏–º.</b>\n"
            "–ê –≤–º–µ—Å—Ç–µ —Å –Ω–∏–º–∏ —É—Ö–æ–¥—è—Ç –∏ –¥–µ–Ω—å–≥–∏.\n\n"
            "–ê —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å —Ç–æ, —á—Ç–æ —Å–ø–æ—Å–æ–±–Ω–æ —ç—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å.\n"
            "–í–∏–¥–µ–æ, –≥–¥–µ —è —Å–æ–±—Ä–∞–ª –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω, –∫–∞–∫ –≤—ã–π—Ç–∏ –Ω–∞ –¥–æ—Ö–æ–¥ –æ—Ç 100.000 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü —Å –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏.\n"
            "–≠—Ç–æ –Ω–µ —Ç–µ–æ—Ä–∏—è, –Ω–µ –ø—É—Å—Ç—ã–µ –æ–±–µ—â–∞–Ω–∏—è.\n–≠—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç.\n\n"
            "<b>–í—Å–µ–≥–æ 20 –º–∏–Ω—É—Ç ‚Äî –∏ —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å, –∫–∞–∫ –ø–µ—Ä–µ—Å—Ç–∞—Ç—å —Ç–µ—Ä—è—Ç—å –∏ –Ω–∞—á–∞—Ç—å –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å.</b>\n\n"
            "–†–µ—à–∏ –¥–ª—è —Å–µ–±—è —á–µ—Å—Ç–Ω–æ:\n—Ç—ã —Ö–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –Ω–∞–±–ª—é–¥–∞—Ç—å, –∫–∞–∫ –º–∏–º–æ –ø—Ä–æ—Ö–æ–¥—è—Ç —Ç–≤–æ–∏ –¥–µ–Ω—å–≥–∏?\n"
            "<b>–ï—Å–ª–∏ –≤—Ç–æ—Ä–æ–µ ‚Äî —Å–º–æ—Ç—Ä–∏ –≤–∏–¥–µ–æ –ø—Ä—è–º–æ —Å–µ–≥–æ–¥–Ω—è.</b>\n"
            "–≠—Ç–æ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —Ç–æ—á–∫–æ–π, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–π —Ç–≤–æ—è –∂–∏–∑–Ω—å —Ä–µ–∞–ª—å–Ω–æ –ø–æ–º–µ–Ω—è–µ—Ç—Å—è."
        )
        await send_photo_with_text(bot, user_id, PHOTOS["p5"], text, get_watch_video_keyboard())

    # –ß–µ—Ä–µ–∑ 24 —á–∞—Å–∞
    await asyncio.sleep(23 * 60 * 60)
    if not users[uid].get("watched", False):
        text = (
            "–°–µ–π—á–∞—Å —Ç—ã –º–æ–∂–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –±—Ä–∞—Ç—å –∑–∞–∫–∞–∑—ã –∑–∞ –∫–æ–ø–µ–π–∫–∏, –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å –∏–∑-–∑–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∏ –≥–∞–¥–∞—Ç—å, "
            "¬´–ø–æ–ª—É—á–∏—Ç—Å—è –ª–∏ –≤–æ–æ–±—â–µ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ¬ª.\n\n"
            "<b>–ê –º–æ–∂–µ—à—å –∑–∞ 20 –º–∏–Ω—É—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ, –≥–¥–µ —è –ø–æ–∫–∞–∑–∞–ª –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –≤—ã—Ö–æ–¥–∞ –Ω–∞ 100.000 —Ä—É–±–ª–µ–π —Å –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏.</b>\n\n"
            "–ò —ç—Ç–æ –Ω–µ –ø—É—Å—Ç—ã–µ —Å–ª–æ–≤–∞.\n–û–¥–∏–Ω –º–æ–π —É—á–µ–Ω–∏–∫ —Å–¥–µ–ª–∞–ª —Ä–æ–≤–Ω–æ —Ç–∞–∫.\n"
            "–û–Ω –±—ã–ª –≤ —Ç–æ–π –∂–µ —Å–∏—Ç—É–∞—Ü–∏–∏, —á—Ç–æ –∏ —Ç—ã: –Ω–µ –∑–Ω–∞–ª, –∫–∞–∫ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤, —Å–æ–º–Ω–µ–≤–∞–ª—Å—è, —á—Ç–æ —É –Ω–µ–≥–æ –ø–æ–ª—É—á–∏—Ç—Å—è, –∏ –±—Ä–∞–ª –∑–∞–∫–∞–∑—ã –∑–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Å—É–º–º—ã.\n"
            "–ü–æ—Ç–æ–º –æ–±—Ä–∞—Ç–∏–ª—Å—è –∫–æ –º–Ω–µ‚Ä¶\n\n"
            "–ß—Ç–æ –≤—ã—à–ª–æ?\n<b>–ó–∞ 2 –º–µ—Å—è—Ü–∞ —Ä–∞–±–æ—Ç—ã –µ–≥–æ –¥–æ—Ö–æ–¥ –ø—Ä–µ–≤—ã—Å–∏–ª 300.000 —Ä—É–±–ª–µ–π.</b>\n\n"
            "–ü—Ä–µ–¥—Å—Ç–∞–≤—å: –≤—Å–µ–≥–æ –ø–∞—Ä–∞ –Ω–µ–¥–µ–ª—å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è ‚Äî –∏ –∂–∏–∑–Ω—å –º–µ–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é. –ò —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ ‚Äî –µ–≥–æ –ø—É—Ç—å, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ—Ö–æ–∂ –Ω–∞ —Ç–æ—Ç –ø–ª–∞–Ω, –∫–æ—Ç–æ—Ä—ã–π —è –¥–∞—é —Ç–µ–±–µ –≤ –≤–∏–¥–µ–æ."
        )
        await send_photo_with_text(bot, user_id, PHOTOS["p6"], text, get_watch_video_keyboard())

    # –ß–µ—Ä–µ–∑ 48 —á–∞—Å–æ–≤
    await asyncio.sleep(48 * 60 * 60)
    if not users[uid].get("watched", False):
        text = (
            "<b>–ö–∞–∫ —è –Ω–∞—à—ë–ª –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ 120.000‚ÇΩ –≤—Å–µ–≥–æ –∑–∞ –Ω–µ–¥–µ–ª—é —Ä–∞—Å—Å—ã–ª–æ–∫?</b>\n\n"
            "–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å—Ç–∞—è.\n–í –º–æ–º–µ–Ω—Ç–µ –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å—Ç–∞–ª–æ —É –º–µ–Ω—è –º–µ–Ω—å—à–µ, —Å—Ç–∞–ª —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —É–¥–µ–ª—è—Ç—å –¥—Ä—É–≥–∏–º –∞—Å–ø–µ–∫—Ç–∞–º –∂–∏–∑–Ω–∏.\n"
            "–ó–Ω–∞—á–∏—Ç —Å–µ–π—á–∞—Å –Ω—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤, –ø–æ—ç—Ç–æ–º—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–π—Ç–∏ –æ–¥–Ω–æ–≥–æ –∏ –∫—Ä—É–ø–Ω–æ–≥–æ.\n\n"
            "–ù–µ –¥–æ–ª–≥–æ –¥—É–º–∞—è, –Ω–∞—á–∏–Ω–∞—é –ø—Ä–æ—Å—Ç–æ —à—Ç—É—Ä–º–æ–≤–∞—Ç—å –ª–∏—á–∫–∏ –≤ –æ–∑–æ–Ω–µ –ø–æ —Å–≤–æ–µ–π —Å–∏—Å—Ç–µ–º–µ, —Å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –æ—Ñ—Ñ–µ—Ä–∞–º–∏.\n\n"
            "–ò —á—Ç–æ —Ç—ã –¥—É–º–∞–µ—à—å?\n–ß–µ—Ä–µ–∑ –ø–∞—Ä—É –¥–Ω–µ–π –∏ –æ–¥–∏–Ω —Å–æ–∑–≤–æ–Ω —É –º–µ–Ω—è –Ω–∞ —Ä—É–∫–∞—Ö –¥–æ–≥–æ–≤–æ—Ä –Ω–∞ 120.000‚ÇΩ.\n\n"
            "–ö —á–µ–º—É —ç—Ç–∞ –∏—Å—Ç–æ—Ä–∏—è?\n–ß—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å: –¥–µ–Ω—å–≥–∏ —Ä–µ–∞–ª—å–Ω–æ —Ä—è–¥–æ–º.\n\n"
            "<b>–ü–æ—Å–º–æ—Ç—Ä–∏ –≤–∏–¥–µ–æ, –≥–¥–µ —è —Å–æ–±—Ä–∞–ª –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω, –∫–∞–∫ –≤—ã–π—Ç–∏ –Ω–∞ –¥–æ—Ö–æ–¥ –æ—Ç 100.000 —Ä—É–±–ª–µ–π —Å –∏–Ω—Ñ–æ–≥—Ä–∞—Ñ–∏–∫–∏.</b>\n"
            "20 –º–∏–Ω—É—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–æ–≥—É—Ç —Ä–µ–∞–ª—å–Ω–æ —Å—Ç–∞—Ç—å —Ç–≤–æ–∏–º –ø–µ—Ä–µ–ª–æ–º–Ω—ã–º –º–æ–º–µ–Ω—Ç–æ–º."
        )
        await send_photo_with_text(bot, user_id, PHOTOS["p6"], text, get_watch_video_keyboard())

# ‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç / –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
@router.message(F.text == "/start")
@router.message(F.text == "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞")
async def start_handler(message: Message):
    uid = str(message.from_user.id)
    users.setdefault(uid, {"contact": False, "watched": False,
                           "username": message.from_user.username or message.from_user.first_name})
    save_users(users)

    photo = FSInputFile(PHOTO_PATH)
    await message.answer_photo(
        photo=photo,
        caption=WELCOME_TEXT,
        reply_markup=get_contact_keyboard()
    )
    asyncio.create_task(reminder_task(message.bot, message.from_user.id, users[uid]["username"]))

# üì© –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞
@router.message(F.contact)
async def contact_handler(message: Message, bot: Bot):
    uid = str(message.from_user.id)
    contact = message.contact
    users[uid]["contact"] = True
    save_users(users)

    text = (
        f"üìû –ù–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç\n"
        f"ID: {message.from_user.id}\n"
        f"User: @{message.from_user.username or '–±–µ–∑ username'}\n"
        f"–ò–º—è: {contact.first_name} {contact.last_name or ''}\n"
        f"–ù–æ–º–µ—Ä: {contact.phone_number}"
    )
    await bot.send_message(chat_id=ADMIN_ID, text=text)

    await message.answer("–ö–æ–Ω—Ç–∞–∫—Ç –ø–æ–ª—É—á–µ–Ω ‚úÖ", reply_markup=get_restart_keyboard())
    await message.answer(VIDEO_TEXT, reply_markup=get_watch_video_keyboard())

# ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è ¬´–ü–æ—Å–º–æ—Ç—Ä–µ–ª –≤–∏–¥–µ–æ¬ª
@router.callback_query(F.data == "watched_video")
async def watched_video_handler(call: CallbackQuery):
    uid = str(call.from_user.id)
    users[uid]["watched"] = True
    save_users(users)

    await call.answer("–û—Ç–ª–∏—á–Ω–æ! –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! üî•")
    await call.message.edit_reply_markup(reply_markup=None)
    await call.message.answer(
        "–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä, –Ω–µ –∑–∞–±—ã–≤–∞–π –Ω–∞–ø–∏—Å–∞—Ç—å –º–Ω–µ –∏ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ–¥–∞—Ä–∫–æ–º)\n\n–£–∂–µ –∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Ç–µ–±—è!",
        reply_markup=get_message_me_keyboard()
    )

# üì¨ –ê–¥–º–∏–Ω –∫–æ–º–∞–Ω–¥—ã
@router.message(F.from_user.id == ADMIN_ID, F.text)
async def admin_handler(message: Message, bot: Bot):
    if message.text.startswith("/status "):
        parts = message.text.split(maxsplit=1)
        uid = parts[1]
        if uid in users:
            await message.answer(
                f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {uid} —Å—Ç–∞—Ç—É—Å:\n–ö–æ–Ω—Ç–∞–∫—Ç: {users[uid]['contact']}\n–í–∏–¥–µ–æ: {users[uid]['watched']}")
        else:
            await message.answer("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.")
    elif message.text == "/users":
        await message.answer("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:\n" + "\n".join(users.keys()))
    elif message.text.startswith("/send "):
        try:
            parts = message.text.split(maxsplit=2)
            user_id = int(parts[1])
            text = parts[2]
            await bot.send_message(chat_id=user_id, text=text)
            await message.answer(f"‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
        except Exception as e:
            await message.answer(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    else:
        # –º–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞
        for uid in users:
            if int(uid) == ADMIN_ID:
                continue
            try:
                await bot.send_message(chat_id=int(uid), text=message.text)
            except Exception as e:
                print(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ {uid}: {e}")

# üöÄ –ó–∞–ø—É—Å–∫
async def main():
    bot = Bot(token=BOT_TOKEN, default=DefaultBotProperties(parse_mode=ParseMode.HTML))
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
